# https://docs.travis-ci.com/user/languages/java/#projects-using-gradle
language: java
# https://www.deps.co/guides/travis-ci-latest-java/
jdk:
  - oraclejdk11
  - openjdk11

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

addons:
  # https://docs.travis-ci.com/user/sonarcloud/
  sonarcloud:
    organization: queryhub
    token:
      secure: "fe78c047c663a9859f71f618f499434eeb4d901a"
  # https://scan.coverity.com/projects/queryhub-queryhub/builds/new?tab=travis_ci
  coverity_scan:
    project:
      name: "queryhub/queryhub"
      description: Small Java DSL for easing SQL query building.
    notification_email: queryhub.pub@gmail.com
    build_command_prepend: ./gradlew check
    build_command: ./gradlew build
    branch_pattern: develop

before_install:
  # https://scan.coverity.com/projects/queryhub-queryhub/builds/new?tab=travis_ci
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

# https://github.com/codecov/example-gradle#-do-you-support-multi-module-projects
after_success:
  - bash <(curl -s https://codecov.io/bash)

script:
  - ./gradlew check sonarqube
